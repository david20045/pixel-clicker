<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>Pixel Clicker Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="game-container">
        <!-- Экран с тапалкой -->
        <div id="exchange" class="screen active">
            <div class="tap-container">
                <h1 class="pixel-text">Биржа</h1>
                <div class="tap-info">
                    <img src="https://imageup.ru/img181/4909204/new-piskel-1.png" class="pixel-coin" alt="Coin">
                    <span id="coins" class="pixel-text">Монеты: 0</span>
                </div>
                <div class="tap-button-container">
                    <img src="https://imageup.ru/img18/4909633/774944f3-e758-428b-8968-0c0eb2820a8a-2.png" class="tap-image" alt="Tap Button" onclick="tap()"> <!-- Картинка с монетой для нажатия -->
                </div>
                <span id="profit-per-hour" class="pixel-text">Прибыль в час: 0</span> <!-- Отображение прибыли в час -->
            </div>
        </div>

        <!-- Магазин с карточками -->
        <div id="shop" class="screen">
            <h1 class="pixel-text">Магазин</h1>
            <div class="cards-container">
                <div class="card" onclick="buyCard('tree')">
                    <img src="https://imageup.ru/img129/4909663/d0a39be1-c3a2-478d-9191-d11e280df730.png" alt="Tree">
                    <p class="pixel-text">Дерево - 100 монет (прибыль: +1000/час)</p>
                </div>
                <div class="card" onclick="buyCard('stone')">
                    <img src="stone_pixel.png" alt="Stone">
                    <p class="pixel-text">Камень - 200 монет (прибыль: +2000/час)</p>
                </div>
                <div class="card" onclick="buyCard('leaf')">
                    <img src="leaf_pixel.png" alt="Leaf">
                    <p class="pixel-text">Лист - 300 монет (прибыль: +3000/час)</p>
                </div>
            </div>
        </div>

        <!-- Вкладка Airdrop (пустая) -->
        <div id="airdrop" class="screen">
            <h1 class="pixel-text">Airdrop</h1>
            <p class="pixel-text">Здесь пока ничего нет.</p>
        </div>

        <!-- Вкладка Задания -->
        <div id="tasks" class="screen">
            <h1 class="pixel-text">Задания</h1>
            <div class="cards-container">
                <!-- Задание 1: Подписка на Telegram -->
                <div class="card">
                    <p class="pixel-text">Подпишитесь на наш Telegram-канал и получите 1 000 000 монет!</p>
                    <a href="https://t.me/example_channel" target="_blank" class="pixel-text">Перейти в Telegram</a>
                    <button onclick="completeTelegramTask()" class="pixel-text">Проверить подписку</button>
                </div>

                <!-- Карточка: Пригласить друга -->
                <div class="card" id="invite-one-reward">
                    <p class="pixel-text">Пригласите одного друга и получите 5000 монет</p>
                    <button onclick="inviteFriendTask(1)" class="pixel-text">Пригласить друга</button>
                </div>

                <!-- Карточка: Пригласить 5 друзей -->
                <div class="card" id="invite-five-reward">
                    <p class="pixel-text">Пригласите 5 друзей и получите 2 000 000 монет</p>
                    <button onclick="inviteFriendTask(5)" class="pixel-text">Пригласить 5 друзей</button>
                </div>
            </div>
        </div>

        <!-- Вкладка Друзья -->
        <div id="friends" class="screen">
            <h1 class="pixel-text">Друзья</h1>
            <div class="cards-container">
                <!-- Карточка с пригласительной ссылкой -->
                <div class="card">
                    <p class="pixel-text">Пригласите друзей по ссылке и получите монеты!</p>
                    <button onclick="generateInviteLink()" class="pixel-text">Создать пригласительную ссылку</button>
                    <p id="invite-link" class="pixel-text"></p> <!-- Здесь будет показана ссылка -->
                    <p id="invited-friends-count" class="pixel-text">Приглашено друзей: 0</p> <!-- Счётчик приглашённых друзей -->
                </div>
            </div>
        </div>

        <!-- Панель навигации -->
        <div class="nav-bar">
            <button onclick="showScreen('exchange')" class="pixel-text">Биржа</button>
            <button onclick="showScreen('shop')" class="pixel-text">Магазин</button>
            <button onclick="showScreen('airdrop')" class="pixel-text">Airdrop</button>
            <button onclick="showScreen('tasks')" class="pixel-text">Задания</button>
            <button onclick="showScreen('friends')" class="pixel-text">Друзья</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Инициализация переменных
        let coins = parseInt(localStorage.getItem('coins')) || 0;
        let profitPerHour = parseInt(localStorage.getItem('profitPerHour')) || 0;
        let lastUpdateTime = parseInt(localStorage.getItem('lastUpdateTime')) || Date.now();
        let invitedFriends = parseInt(localStorage.getItem('invitedFriends')) || 0; // Количество приглашённых друзей
        let friendsRegistered = parseInt(localStorage.getItem('friendsRegistered')) || 0; // Количество зарегистрированных друзей
        let telegramSubscribed = localStorage.getItem('telegramSubscribed') === 'true'; // Проверка подписки на Telegram
        let completedTasks = JSON.parse(localStorage.getItem('completedTasks')) || {}; // Выполненные задания

        // Обновление экрана с монетами
        function updateCoinsDisplay() {
            document.getElementById('coins').textContent = `Монеты: ${Math.floor(coins)}`;
            document.getElementById('profit-per-hour').textContent = `Прибыль в час: ${profitPerHour}`;
            document.getElementById('invited-friends-count').textContent = `Приглашено друзей: ${invitedFriends}`;
            
            // Сохраняем данные
            localStorage.setItem('coins', coins);
            localStorage.setItem('profitPerHour', profitPerHour);
            localStorage.setItem('invitedFriends', invitedFriends);
            localStorage.setItem('friendsRegistered', friendsRegistered);
            localStorage.setItem('telegramSubscribed', telegramSubscribed);
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            
            updateInviteTaskStatus(); // Обновление состояния заданий
        }

        // Функция нажатия на тапалку
        function tap() {
            coins += 1;
            animateTap();
            updateCoinsDisplay();
        }

        // Анимация нажатия на тапалку
        function animateTap() {
            const tapImage = document.querySelector('.tap-image');
            tapImage.classList.add('tapped');
            setTimeout(() => tapImage.classList.remove('tapped'), 100);
        }

        // Функция покупки карточек
        function buyCard(type) {
            let price, profit;

            if (type === 'tree') {
                price = 100;
                profit = 1000;
            } else if (type === 'stone') {
                price = 200;
                profit = 2000;
            } else if (type === 'leaf') {
                price = 300;
                profit = 3000;
            }

            if (coins >= price) {
                coins -= price;
                profitPerHour += profit;
                alert(`Вы купили ${type}, теперь ваша прибыль: ${profitPerHour} монет в час!`);
                updateCoinsDisplay();
            } else {
                alert("Недостаточно монет.");
            }
        }

        // Начисление монет за прошедшее время, пока игрок отсутствовал
        function addCoinsForElapsedTime() {
            const currentTime = Date.now();
            const timeElapsed = (currentTime - lastUpdateTime) / 1000; // Время в секундах

            if (timeElapsed > 0) {
                const coinsEarned = (profitPerHour / 3600) * timeElapsed;
                coins += coinsEarned;
                lastUpdateTime = currentTime;
                updateCoinsDisplay();
            }
        }

        // Выполняется каждую секунду для начисления монет
        setInterval(addCoinsForElapsedTime, 1000);

        // Переключение экрана
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Генерация пригласительной ссылки
        function generateInviteLink() {
            const inviteLink = `https://t.me/PixelClickerGameBot/start?start=${encodeURIComponent(`invite_${Date.now()}`)}`;
            document.getElementById('invite-link').textContent = inviteLink;
            document.getElementById('invite-link').setAttribute('href', inviteLink);
        }

        // Завершение задания по подписке на Telegram
        function completeTelegramTask() {
            if (telegramSubscribed) {
                alert('Вы уже подписаны на Telegram-канал.');
                return;
            }
            // Здесь можно добавить логику проверки подписки через API Telegram
            telegramSubscribed = true;
            coins += 1000000; // Присвоение монет за подписку
            updateCoinsDisplay();
            alert('Поздравляем! Вы подписались на Telegram-канал и получили 1 000 000 монет!');
        }

        // Завершение задания по приглашению друга
        function inviteFriendTask(count) {
            if (invitedFriends >= count) {
                coins += (count === 1) ? 5000 : 2000000;
                alert(`Поздравляем! Вы выполнили задание и получили ${count === 1 ? '5 000' : '2 000 000'} монет!`);
                invitedFriends -= count;
                updateCoinsDisplay();
            } else {
                alert(`Необходимо пригласить ${count} друзей для выполнения задания.`);
            }
        }

        // Обновление статуса выполнения заданий
        function updateInviteTaskStatus() {
            document.getElementById('invite-one-reward').style.display = invitedFriends >= 1 ? 'none' : 'block';
            document.getElementById('invite-five-reward').style.display = invitedFriends >= 5 ? 'none' : 'block';
        }

        // Инициализация состояния при загрузке
        updateCoinsDisplay();
    </script>
</body>
</html>
